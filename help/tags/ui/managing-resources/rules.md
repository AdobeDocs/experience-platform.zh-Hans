---
title: 规则
description: 瞭解標籤擴充功能在Adobe Experience Platform中的運作方式。
exl-id: 2beca2c9-72b7-4ea0-a166-50a3b8edb9cd
source-git-commit: 88939d674c0002590939004e0235d3da8b072118
workflow-type: tm+mt
source-wordcount: '1973'
ht-degree: 67%

---

# 规则

>[!NOTE]
>
>Adobe Experience Platform Launch已經過品牌重塑，現在是Adobe Experience Platform中的一套資料收集技術。 因此，产品文档中的术语有一些改动。有关术语更改的综合参考，请参阅以下[文档](../../term-updates.md)。

Adobe Experience Platform 中的标签遵循基于规则的系统。他们寻找用户交互和相关数据。如果满足您的规则中所列的标准，则规则会触发您已识别的扩展、脚本或客户端代码。

构建规则可将数据与营销和广告技术的功能整合到一起，从而将不同的产品统一到单个解决方案中。

## 規則結構

**事件 (If)：**&#x200B;事件是您希望规则查找的内容。这可通过选择事件、任何适用条件和任何例外进行定义。

**操作 (Then)：**&#x200B;在规则事件发生并满足所有条件后进行触发。標籤規則可讓您視需要觸發許多獨立動作，而且您可以控制這些動作發生的順序。 例如，只需一个对应某电子商务“感谢”页面的规则，便可通过单个规则触发您的分析工具和第三方标记。无需为每个扩展或标记创建单独的规则。

您可以添加更多事件类型。多个事件使用 OR 进行连接，因此，如果满足其中的任何事件，则将评估规则的条件。

>[!IMPORTANT]
>
>所做的更改在[发布](../publishing/overview.md)之后才会生效。

### 事件和条件 (if)

包含任何条件的事件属于规则的 *If* 部分。

如果发生指定的事件，则会评估条件，然后在需要时执行指定的操作。

* **事件**：指定一或多個必須發生的事件以觸發規則。 多个事件使用 OR 进行连接。任何指定的事件都将触发规则。

* **條件**：設定事件必須是true的任何條件來縮小事件，以觸發規則。 例外被定义为 NOT 条件。多个条件使用 AND 进行连接。

可用的事件取决于已安装的扩展。有关核心扩展中的事件的信息，请参阅[核心扩展事件类型](../../extensions/client/core/overview.md#core-extension-event-types)。

### 操作 (then)

操作属于规则的 *Then* 部分。它们定义您希望规则运行时发生的情况。触发事件时，如果条件评估为 true 且例外评估为 false，则会执行操作。您可以根据需要拖放操作以对其进行排序。

## 创建规则

通过指定满足条件时执行的操作来创建规则。

1. 開啟 [!UICONTROL 規則] 索引標籤，然後選取 **[!UICONTROL 建立新規則]**.

   ![](../../images/launch-rule-builder.jpg)

1. 命名规则。
1. 選取事件 **[!UICONTROL 新增]** 圖示。
1. 选择您的扩展以及该扩展可用的事件类型之一，然后配置该事件的设置。

   ![](../../images/rule-event-config.png)

   可用事件类型取决于您选择的扩展。事件设置将因事件类型而异。某些事件不需要配置任何设置。

   >[!IMPORTANT]
   >
   >在客户端规则中，数据元素使用 `%` 对其名称的开头和结尾进行标记。例如：`%viewportHeight%`。在事件轉送規則中，資料元素會透過下列方式進行代碼化： `{{` 開頭和 `}}` 位於資料元素名稱結尾。 例如：`{{viewportHeight}}`。

   要引用来自 Edge Network 的数据，数据元素路径必须为 `arc.event._<element>_`。

   其中，`arc` 表示 Adobe 响应上下文。

   例如：`arc.event.xdm.web.webPageDetails.URL`

   >[!IMPORTANT]
   >
   >如果指定的路径不正确，将无法收集数据。

1. 設定Order引數，然後選取 **[!UICONTROL 保留變更]**.

   所有规则组件的默认顺序为 50。如果您希望某个规则先运行，则可为其指定一个小于 50 的数字。

   * 执行顺序就是数字的顺序。1 在 3 之前运行。3 在 10 之前运行。10 在 100 之前运行，依此类推。
   * 具有相同顺序的规则不会按特定顺序运行。
   * 规则会按顺序触发，但不一定会以同一顺序完成。如果规则 A 和规则 B 共享一个事件，并且您为它们分配了顺序，以便规则 A 先运行，在这种情况下，如果规则 A 异步执行某些操作，则无法保证规则 A 会在规则 B 开始之前完成运行。

      如果您希望某个规则后运行，则可为其指定一个大于 50 的数字。有关排序的更多信息，请参阅[规则排序](rules.md#rule-ordering)。

1. 選取條件 **[!UICONTROL 新增]** 圖示，然後選擇邏輯型別、擴充功能、條件型別並設定條件的設定。 接下來，選取 **[!UICONTROL 保留變更]**.

   ![](../../images/condition-settings.png)

   可用条件类型取决于您选择的扩展。条件设置将因条件类型而异。

   逻辑类型：

   * 常规逻辑类型允许在满足条件时执行操作
   * 例外逻辑类型阻止在满足条件时执行操作

   （高级）Timeout：在资产上启用规则组件排序后，此选项将可用。此属性定义允许条件运行的最长时间。如果达到超时，则该条件将失败，并将从处理队列中删除此规则的其余条件和操作。默认值为 2000 毫秒。

   您可以根据需要添加任意数量的条件。同一规则内的多个条件使用 AND 进行连接。

1. 選取動作 **[!UICONTROL 新增]** 圖示，然後選擇您的擴充功能以及該擴充功能可用的其中一種動作型別，設定動作的設定，然後選取 **[!UICONTROL 保留變更]**.

   ![](../../images/action-settings.png)

   可用操作类型取决于您选择的扩展。操作设置将因操作类型而异。

   （高级）Wait to run next action：在资产上启用规则组件排序后，此选项将可用。如果勾選，標籤將不會呼叫下一個動作，直到此動作完成。 如果不选中此选项，将立即开始执行下一个操作。預設值為 **[!UICONTROL 已核取]**.

   （高级）Timeout：在资产上启用规则组件排序后，此选项将可用。此属性定义允许操作完成的最长时间。如果达到超时，则该操作将失败，并将从处理队列中删除此规则的所有后续操作。默认值为 2000 毫秒。


1. 檢閱您的規則，然後選取 **[!UICONTROL 儲存規則]**.

   稍后，当您[发布](../publishing/overview.md)时，您会将此规则添加到库中并对其进行部署。

创建或编辑规则时，您可以将其保存并生成到[活动库](../publishing/libraries.md#active-library)中。这会立即将更改保存到库并执行生成操作。随即会显示生成操作的状态。

## 规则排序 {#rule-ordering}

规则排序允许您控制共享某一事件的多个规则的执行顺序。每個規則都包含決定其順序優先順序的整數（預設值為50）。 包含較低順序值的規則會先於包含較高值的規則執行。

請考量一組五項規則，這些規則全都共用一個事件，而且都擁有預設優先順序：

* 如果您想要在最後執行某個規則，可以編輯該規則元件，並為它指定大於50 （例如60）的數字。
* 如果您想要先執行某個規則，可以編輯該規則元件，並為它指定小於50 （例如40）的數字。

>[!NOTE]
>
>最終，執行動作的責任在於使用您正在使用的事件型別的擴充功能開發人員。 Adobe擴充功能開發人員可確保擴充功能正常運作。 Adobe為協力廠商擴充功能開發人員提供正確執行此作業的指引，但無法保證如何遵循這些指引。

強烈建議您使用1到100 （預設為50）之間的正數來排序規則。 由於規則順序必須手動維護，因此最佳實務是儘可能保持訂購配置簡單。 如果邊緣案例中此限制太具限制性，則標籤支援介於+/- 2,147,483,648之間的規則順序編號。

### 客户端规则处理

规则的加载顺序取决于以下两点：规则操作是使用 JavaScript、HTML 还是其他客户端代码配置；规则是使用 page bottom 事件、page top 事件还是其他类型的事件。

无论为规则配置哪种事件，您都可以在自定义脚本中使用 `document.write`。

您可以对不同的自定义代码类型进行排序。例如，您现在可以先执行 JavaScript 自定义代码操作，接着执行 HTML 自定义代码操作，最后再执行 JavaScript 自定义代码操作。標籤可確保依照該順序執行。

## 規則套裝

規則事件和條件一律會整合至主要標籤程式庫。 操作可以绑定到主库中，也可在以后根据需要以子资源的形式进行加载。是否捆绑操作取决于规则的事件类型。

### 包含“Core - Library Loaded”或“Core - Page Top”事件的规则

由于几乎总是需要执行这些事件（除非条件评估为 false），因此，为了提高效率，这些事件将捆绑到主库（即，您的嵌入代码所引用的文件）中。

* **Javascript：** JavaScript已內嵌於主要標籤程式庫中。 自定义脚本将封装在脚本标记中，并使用 `document.write` 写入文档。如果规则具有多个自定义脚本，则系统会按顺序写入它们。

* **HTML：** HTML內嵌於主要標籤程式庫中。 使用 `document.write` 将 HTML 写入文档。如果规则具有多个自定义脚本，则系统会按顺序写入它们。

### 包含任何其他事件的规则

Adobe 无法保证会实际触发任何其他规则，并且会需要其操作代码。因此，以上未列出的所有事件类型的操作将不会打包到主库中，而是作为子资源进行存储，并由主库根据需要进行引用。

* **JavaScript：** JavaScript 将作为常规文本从服务器加载，封装在脚本标记中，并使用 Postscribe 添加到文档中。如果规则具有多个 JavaScript 自定义脚本，则它们将同时从服务器加载，但会以规则中配置的顺序执行。
* **HTML：** HTML 将从服务器加载，并使用 Postscribe 添加到文档中。如果规则具有多个自定义 HTML 脚本，则它们将同时从服务器加载，但会以规则中配置的顺序执行。

## 規則元件排序 {#sequencing}

執行階段環境的行為取決於是否 **[!UICONTROL 依序執行規則元件]** 開啟或關閉您的屬性。 此設定決定規則的元件是否可以並行評估（非同步），或是否必須依序評估。

>[!IMPORTANT]
>
>此設定只會決定每個規則中條件和動作的評估方式，不會影響規則本身在屬性上執行的順序。 請參閱上一節，瞭解 [規則順序](#rule-ordering) 有關如何確定多個規則的執行順序的詳細資訊。
>
>在 [事件轉送](../event-forwarding/overview.md) 屬性、規則動作一律依序執行，且此設定無法使用。 创建规则时应确保顺序正确。

### 已启用

如果在執行階段觸發事件時啟用此設定，則規則的條件和動作會新增至處理佇列（根據您定義的順序），並以「先進先出」(FIFO)為基礎一次處理一項。 規則會等待元件完成，再移至下一個元件。

如果条件的评估结果为 false 或达到其定义的超时，将从队列中删除该规则的后续条件和操作。

如果操作失败或达到其定义的超时，将从队列中删除该规则的后续操作。

### 已禁用

如果已禁用，则在运行时触发事件时，将立即评估该规则的条件。将并行评估多个条件。

如果所有条件都返回 true（异常时返回 false），将立即执行该规则的操作。系統會依順序呼叫動作，但標籤不會等到動作完成後才呼叫下一個動作。 如果您的操作是同步的，它们仍将按顺序执行。如果一个或多个操作是异步执行的，则一些操作将并行运行。
